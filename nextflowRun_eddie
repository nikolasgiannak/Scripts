
# Steps to follow for Nextflow pipelines. 

# This is an exmple for an RNAseq pipeline but the same principles apply for all the pipelines.

# Nextflow pipelines need to be run interactively, in an interactive session on Eddie. 

# The pipeline will then submit jobs to the Eddie scheduler for you.

# The following steps need to be followed.

#  1. Login into eddie
                        ssh  ngiannak@eddie.ecdf.ed.ac.uk

#  2. Start a screen session
                        [ngiannak@login01(eddie) ~]$ screen

# Comment 1:    To inspect the presence of an active screen, DO THIS:
                        screen -ls

  Comment 2:    There is a screen on:  1506484.pts-251.login01 (Detached)
#                1 Socket in /run/screen/S-ngiannak. 


# 3. Once in the screen session, start a qlogin session with a good amount of virtual memory ( 32GB seems to work for this particular pipeline):
                        qlogin -l h_vmem=32G

# 4. In the qlogin session, you I can then set the input/output variables and load the appropriate modules to be used for the analysis
                        module load igmm/apps/nextflow/24.04.4
                        module load singularity
                        module load java

# 5. Load reference genome files, path to fasta files, output directory and samplesheet with sample files.
                       GTF_PATH=/gpfs/igmmfs01/eddie/BioinformaticsResources/igenomes/Mus_musculus/Ensembl/GRCm39/Annotation/Genes/genes.gtf
                       FASTA_PATH=/gpfs/igmmfs01/eddie/BioinformaticsResources/igenomes/Mus_musculus/Ensembl/GRCm39/Sequence/WholeGenomeFasta/genome.fa
                       OUTPUT_DIR=/exports/eddie/scratch/ngiannak/Data/singleEndRNAseq/output
                       SAMPLESHEET=/exports/eddie/scratch/ngiannak/Data/singleEndRNAseq/samplesheet.csv

# 6. Run the pipeline you little silly. This is how you do it. Take it or leave it :p
                      nextflow run nf-core/rnaseq --input=$SAMPLESHEET --outdir=$OUTPUT_DIR --gtf=$GTF_PATH --fasta=$FASTA_PATH -profile eddie
                
# This pipeline will do some initial processing locally (i.e. in the interactive session) and then submit some jobs to the Eddie scheduler for you.
# The amount/size of jobs it submits is related to your input data and your eddie profile/config. 
# The warning messages generated by the pipeline can be ignored. 


# In the directories /exports/eddie/scratch/ngiannak/Data/singleEndRNAseq/output and /exports/eddie/scratch/ngiannak/Data/singleEndRNAseq/work, 
# I can see various directories/files generated by the pipeline. In the 'work' directory specifically I can see the job submission scripts
# generated by Nextflow and the output/error files generated by the scheduler for the submitted jobs. 
# These are all hidden files under the respective work directories (each job gets one work directory). 

# For example, see in 
# /exports/eddie/scratch/ngiannak/Data/singleEndRNAseq/work/e6/6c2ee08ba1ca7e8b25164385dbb6c8
# The hidden files .command.begin  .command.log  .command.run  .command.trace   .command.err    .command.out  .command.sh   .exitcode  
# are all files related to the job and can help you work out the reasons why the job may have failed (if it does fail).


# 7. After the succesful completion of the pipeline I will get the output here:
                        /exports/eddie/scratch/ngiannak/Data/singleEndRNAseq/output.

# 8. To monitor the progress of the pipeline by reconnecting to the screen session that has been started (check comment 2 at point 2):
                      screen -r 1506484.pts-251.login01 















