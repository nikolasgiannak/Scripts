1. Here is how my directory for the single-end RNAseq analysis on EDDIE should be:

project/
├── raw_data/                # FASTQ files
├── trimmed/                # Output of cutadapt
├── qc/                     # FastQC and MultiQC reports
├── aligned/                # BAM files
├── counts/                 # HTSeq-count output
├── scripts/                # SLURM scripts
├── reference/              # Genome FASTA and GTF
└── results/                # DESeq2 output



2. This is how the metadata file should look like:

sample,condition,fastq
S1,SAMPLE_1,raw_data/S1.fastq.gz
S2,SAMPLE_2,raw_data/S2.fastq.gz
...
S24,SMAPLE_24,raw_data/S24.fastq.gz


3. This is how the script for the pipeline should be, and it has to be saved as scripts/singleEndRNAseq_pipeline.sh and get submitted as a job:

#!/bin/bash
#SBATCH --job-name=rnaseq_pipeline
#SBATCH --output=logs/rnaseq_%j.out
#SBATCH --error=logs/rnaseq_%j.err
#SBATCH --time=24:00:00
#SBATCH --mem=32G
#SBATCH --cpus-per-task=8

module load fastqc cutadapt hisat2 samtools htseq R

# Step 1: QC
mkdir -p qc
for fq in raw_data/*.fastq.gz; do
    fastqc $fq -o qc/
done
multiqc qc/ -o qc/

# Step 2: Trimming
mkdir -p trimmed
for fq in raw_data/*.fastq.gz; do
    base=$(basename $fq .fastq.gz)
    cutadapt -q 20 -o trimmed/${base}_trimmed.fastq.gz $fq
done

# Step 3: Alignment
mkdir -p aligned
for fq in trimmed/*_trimmed.fastq.gz; do
    base=$(basename $fq _trimmed.fastq.gz)
    hisat2 -p 8 -x reference/genome_index -U $fq | \
    samtools view -bS - | samtools sort -o aligned/${base}.bam
done

# Step 4: Quantification
mkdir -p counts
for bam in aligned/*.bam; do
    base=$(basename $bam .bam)
    htseq-count -f bam -r pos -s no -i gene_id $bam reference/genes.gtf > counts/${base}_counts.txt
done


4. This is the command to run the script on Eddie
sbatch singleEndRNAseq_pipeline.sh



